@using eShopFlix.Web.Models.Stock
@model IReadOnlyList<StockAlertModel>
@{
    ViewData["Title"] = "Stock Alerts";
}

<div class="d-flex align-items-center justify-content-between mb-3">
    <div>
        <a asp-action="Index" class="text-decoration-none small">? Back to Stock</a>
        <h2 class="mb-0 mt-1">Active Alerts</h2>
    </div>
    <span class="text-muted">@Model.Count alert(s)</span>
</div>

@if (Model.Count == 0)
{
    <div class="card shadow-sm">
        <div class="card-body text-center py-5">
            <div class="display-1 mb-3">?</div>
            <h5 class="text-muted">No active alerts</h5>
            <p class="text-muted small">All stock levels are within normal range.</p>
        </div>
    </div>
}
else
{
    <!-- Summary -->
    <div class="row g-3 mb-3">
        <div class="col-md-4">
            <div class="card shadow-sm border-start border-danger border-4">
                <div class="card-body text-center">
                    <div class="small text-muted">Low Stock</div>
                    <div class="fs-4 fw-bold text-danger">@Model.Count(a => a.AlertType == "LowStock")</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm border-start border-warning border-4">
                <div class="card-body text-center">
                    <div class="small text-muted">Over Stock</div>
                    <div class="fs-4 fw-bold text-warning">@Model.Count(a => a.AlertType == "OverStock")</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm border-start border-info border-4">
                <div class="card-body text-center">
                    <div class="small text-muted">Expiry</div>
                    <div class="fs-4 fw-bold text-info">@Model.Count(a => a.AlertType == "Expiry")</div>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover mb-0 align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Type</th>
                        <th>Message</th>
                        <th>SKU</th>
                        <th>Warehouse</th>
                        <th>Status</th>
                        <th>Triggered</th>
                        <th>Acknowledged</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var alert in Model.OrderByDescending(a => a.TriggeredAt))
                    {
                        <tr>
                            <td><span class="badge @alert.AlertBadgeClass">@alert.AlertType</span></td>
                            <td class="small">@alert.Message</td>
                            <td class="text-muted small fw-semibold">@(alert.Sku ?? "—")</td>
                            <td class="text-muted small">@(alert.WarehouseName ?? "—")</td>
                            <td><span class="badge @alert.StatusBadgeClass">@alert.AlertStatus</span></td>
                            <td class="text-muted small">@alert.TriggeredAt.ToString("dd MMM HH:mm")</td>
                            <td class="text-muted small">@(alert.AcknowledgedAt?.ToString("dd MMM HH:mm") ?? "—")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
